<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel del Usuario - Farmacia Paracetamol üíä</title>
  <link rel="stylesheet" href="/stylesheets/styles.css">
</head>

<%- include('partials/header') %>
  <main class="productos-container">
    <h2>Productos disponibles</h2>

    <!-- Buscador / Filtros -->
    <div class="filtros">
      <input type="text" id="buscar" placeholder="Buscar producto...">
      <select id="categoria">
        <option value="">Todas las categor√≠as</option>
        <option value="analg√©sicos">Analg√©sicos</option>
        <option value="antibi√≥ticos">Antibi√≥ticos</option>
        <option value="vitaminas">Vitaminas</option>
      </select>
    </div>

    <!-- Lista de productos -->
    <div id="lista-productos" class="lista-productos">
      <!-- Los productos se cargar√°n din√°micamente desde /api/productos -->
    </div>
  </main>
<%- include('partials/footer') %>

  <script>
    //  Cargar productos desde la API
    console.log("esetomos en user")
    async function cargarProductos() {
      const res = await fetch('http://localhost:3000/api/productos');
      const data = await res.json();
      console.log(await data)
      const contenedor = document.getElementById('lista-productos');
      contenedor.innerHTML = '';

      data.items.forEach(p => {
        const card = document.createElement('div');
        card.classList.add('producto-card');
        card.innerHTML = `
          <img src="${'/fotos/6.jpg'}" alt="${p.marca}">
          <h3>${p.marca}</h3>
          <p>$${p.precio}</p>
          <button onclick="agregarAlCarrito(${p.codigo}, '${p.marca}', ${p.precio})">Agregar al carrito</button>
        `;
        contenedor.appendChild(card);
      });
    }

    // üîπ Simulaci√≥n de carrito
    let carrito = [];

    function agregarAlCarrito(id, nombre, precio) {
      const existente = carrito.find(p => p.id === id);
      if (existente) {
        existente.cantidad++;
      } else {
        carrito.push({ id, nombre, precio, cantidad: 1 });
      }
      alert(`üõí ${nombre} agregado al carrito`);
    }

    // üîπ Filtro de b√∫squeda
    document.getElementById('buscar').addEventListener('input', e => {
      const texto = e.target.value.toLowerCase();
      document.querySelectorAll('.producto-card').forEach(card => {
        const nombre = card.querySelector('h3').textContent.toLowerCase();
        card.style.display = nombre.includes(texto) ? 'block' : 'none';
      });
    });

    // üîπ Filtro por categor√≠a (opcional)
    document.getElementById('categoria').addEventListener('change', e => {
      const categoria = e.target.value;
      // En el futuro podr√≠as hacer fetch('/api/productos?categoria=...')
      console.log(`Filtrar por categor√≠a: ${categoria}`);
    });

    // Cargar los productos al entrar
    cargarProductos();
  </script>
</body>
</html>
